# JH AGENT FACTORY - Global Config
# CHUNSIK PROTOCOL v1.0 기준
# 목적: 시스템 전역 정책(리소스/로그/통신/레벨업/임계치)을 한 곳에서 관리

version: "1.0.0"
factory_name: "JH Agent Factory"
protocol: "CHUNSIK_PROTOCOL_v1.0-runtime"

owner:
  name: "이재하"
  locale: "ko-KR"
  timezone: "Asia/Seoul"

paths:
  agents_root: "agents"
  skills_library_root: "skills_library"
  prompts_root: "prompts"
  registry_file: "core/registry.json"

limits:
  # 에이전트 1개 폴더의 총 용량 상한(기본 100MB)
  agent_storage_mb: 100
  warn_storage_ratio: 0.80   # 80% 경고
  archive_storage_ratio: 0.95 # 95% 자동 아카이빙
  hard_stop_storage_ratio: 1.00 # 100% 쓰기 중단

  # 단일 작업 컨텍스트 토큰 상한
  task_context_token_limit: 4000

  # 반복/루프 보호
  max_retries_per_action: 3
  max_same_task_repeats: 5

logs:
  # 로그는 append-only (삭제/변조 금지)
  retention_days: 30
  rotate:
    enabled: true
    max_file_mb: 10
    keep_files: 20

message_bus:
  # requires_ack=true 메시지 ACK 정책
  ack_timeout_seconds: 30
  resend_max_attempts: 3
  resend_backoff_seconds: [1, 3, 8] # 재전송 대기(초)

resources_policy:
  tool_priority:
    - "local_free_libs"
    - "self_hosted_oss"
    - "free_tier_external"
    - "paid_external_requires_owner_approval"

  paid_approval_required: true

  # 컨텍스트/메모리 비대화 방지
  memory:
    compress_on_context_overflow: true
    compress_target_ratio: 0.35
    compressed_folder: "memory/compressed"

agent_defaults:
  initial_level:
    master: 5
    worker: 1

  default_status: "initialized" # initialized -> online -> (dormant/unstable/suspended)

  storage_mb: 100

  # 마스터 생성 시 자동 장착할 기본 스킬(예: catalog.json의 skill_id)
  master_default_skills:
    - "log_analyzer"
    - "resource_monitor"
    - "api_reconnector"
    - "memory_compressor"

  # 워커 생성 시 기본 스킬(필요 없으면 빈 배열 유지)
  worker_default_skills: []

connections:
  # 일반→일반 직접 통신은 마스터가 연결 허가한 경우만
  worker_to_worker_requires_master_link: true

  # 일반→소유자 보고는 원칙적으로 마스터 경유(critical 예외)
  worker_to_owner_requires_master: true
  critical_bypass_owner_direct: true

state_machine:
  # 휴면/불안정 판정 임계치(초기값: 보수적으로)
  dormant_if_no_activity_days: 30
  unstable_if_error_rate_over: 0.30

evolution:
  # 레벨업 기준(설계서 LAYER6을 설정값으로도 보관)
  level_rules:
    "1_to_2":
      required_skills: 1
      required_success_tasks: 1
    "2_to_3":
      required_skills: 3
      required_completed_tasks: 10
    "3_to_5":
      required_has_connections: true
      required_completed_tasks: 50
      max_error_rate: 0.10
    "5_to_7":
      required_frameworks: 1
      required_completed_tasks: 200
    "7_to_10":
      required_skill_proposals: 1
      required_completed_tasks: 500
      max_error_rate: 0.05

  stats:
    # Stats 산정 가중치(초기값은 임시; Phase2에서 개선 가능)
    weights:
      INT: 1.0
      MEM: 1.0
      SPD: 1.0
      REL: 1.0

security:
  # API 서버용 인증(Phase4에서 실제로 사용)
  auth:
    enabled: true
    owner_api_key_env: "JH_FACTORY_OWNER_API_KEY"

  # 금지 정책(핵심 원칙)
  prohibit_external_calls_without_approval: true
  prohibit_log_mutation: true
  prohibit_cross_agent_folder_access: true
